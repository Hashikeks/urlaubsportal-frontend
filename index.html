<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Urlaubsportal</title>
<style>
body{
    background: linear-gradient(180deg,#1e3c72,#1b335f);
    font-family: Arial;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:40px;
}
.container{
    background:#243f66;
    width:600px;
    padding:30px;
    border-radius:20px;
    border:2px solid #5c7aa6;
    box-shadow:0 15px 40px rgba(0,0,0,0.4);
    color:white;
    margin-bottom:20px;
}
h2,h3{margin-bottom:15px;}
input{
    width:100%;
    padding:10px;
    margin-top:5px;
    border-radius:8px;
    border:none;
}
button{
    padding:6px 12px;
    border-radius:20px;
    border:none;
    font-size:12px;
    font-weight:bold;
    cursor:pointer;
    background:#1db954;
    color:white;
}
button:hover{background:#169944;}
.hidden{display:none;}
.dropdown-content{display:none;margin-top:10px;}
hr{border-color:#5c7aa6;}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
<h2>Login</h2>
<input type="password" id="loginPw" placeholder="Passwort">
<button onclick="login()">Login</button>
<p id="loginMsg"></p>
</div>

<!-- MITARBEITER -->
<div class="container hidden" id="mitarbeiterBox">
<h2>Urlaubsantrag</h2>
<label>Name</label>
<input id="name">
<label>Dienstnummer</label>
<input id="dienstnummer">
<label>Start</label>
<input type="date" id="start">
<label>Ende</label>
<input type="date" id="end">
<label>Grund</label>
<input id="grund">
<br><br>
<button onclick="urlaubEinreichen()">Einreichen</button>
<button onclick="logout()">Logout</button>
<p id="msg"></p>
</div>

<!-- LEITUNG -->
<div class="container hidden" id="leitungBox">
<h2>Leitung</h2>
<h3>Offene Urlaube</h3>
<div id="offene"></div>

<h3>Genehmigte Urlaube</h3>
<div id="genehmigt"></div>

<h3>Abgelehnte Urlaube</h3>
<div id="abgelehnt"></div>

<button onclick="logout()">Logout</button>
</div>

<script>

const BACKEND_URL="https://urlaubsportal-backend-production.up.railway.app";

let urlaube=[];

/* ================= LOGIN ================= */

function login(){
    const pw=document.getElementById("loginPw").value;

    if(pw==="mitarbeiter"){
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("mitarbeiterBox").classList.remove("hidden");
    }
    else if(pw==="leitung"){
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("leitungBox").classList.remove("hidden");
        lade();
    }
    else{
        document.getElementById("loginMsg").innerText="Falsches Passwort";
    }
}

function logout(){
    location.reload();
}

/* ================= DATEN ================= */

async function lade(){
    const res=await fetch(`${BACKEND_URL}/data`);
    const data=await res.json();
    urlaube=data.urlaube;
    render();
}

function formatDate(d){
    return new Date(d).toLocaleDateString("de-DE");
}

/* ================= MITARBEITER ================= */

async function urlaubEinreichen(){
    const name=document.getElementById("name").value;
    const dienstnummer=document.getElementById("dienstnummer").value;
    const start=document.getElementById("start").value;
    const end=document.getElementById("end").value;
    const grund=document.getElementById("grund").value;

    const res=await fetch(`${BACKEND_URL}/urlaub`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,dienstnummer,start,end,grund})
    });

    const data=await res.json();

    if(data.error){
        document.getElementById("msg").innerText=data.error;
        document.getElementById("msg").style.color="red";
    }else{
        document.getElementById("msg").innerText="Antrag eingereicht";
        document.getElementById("msg").style.color="lightgreen";
    }
}

/* ================= LEITUNG ================= */

async function genehmigen(name,start,end){
    await fetch(`${BACKEND_URL}/genehmigen`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,start,end})
    });
    lade();
}

async function ablehnen(name,start,end){
    await fetch(`${BACKEND_URL}/ablehnen`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,start,end})
    });
    lade();
}

async function loeschen(name,start,end){
    await fetch(`${BACKEND_URL}/loeschen`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,start,end})
    });
    lade();
}

function render(){

    const offene=urlaube.filter(u=>u.status==="eingereicht");
    const genehmigte=urlaube.filter(u=>u.status==="genehmigt");
    const abgelehnte=urlaube.filter(u=>u.status==="abgelehnt");

    renderListe(offene,"offene",true);
    renderListe(genehmigte,"genehmigt",false);
    renderListe(abgelehnte,"abgelehnt",false);
}

function renderListe(list,id,mitButtons){

    const box=document.getElementById(id);
    box.innerHTML="";

    if(list.length===0){
        box.innerHTML="Keine Einträge";
        return;
    }

    list.forEach(u=>{

        const div=document.createElement("div");
        div.style.border="1px solid #5c7aa6";
        div.style.padding="10px";
        div.style.margin="8px 0";

        div.innerHTML=`
            <strong>${u.name}</strong> (${u.dienstnummer})<br>
            ${formatDate(u.start)} - ${formatDate(u.end)}<br>
            <strong>Grund:</strong> ${u.grund}
        `;

        if(mitButtons){
            div.innerHTML+=`
                <div style="display:flex; gap:10px; margin-top:8px;">
                    <button onclick="genehmigen('${u.name}','${u.start}','${u.end}')">Genehmigen</button>
                    <button onclick="ablehnen('${u.name}','${u.start}','${u.end}')">Ablehnen</button>
                </div>
            `;
        }else{
            div.innerHTML+=`
                <br>
                <button onclick="loeschen('${u.name}','${u.start}','${u.end}')">Löschen</button>
            `;
        }

        box.appendChild(div);
    });
}

</script>
</body>
</html>

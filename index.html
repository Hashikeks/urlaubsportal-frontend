<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Urlaubsportal</title>
<style>
body {
    background: linear-gradient(180deg, #1e3c72, #1b335f);
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px;
}
.container {
    background: #243f66;
    width: 600px;
    padding: 35px;
    border-radius: 20px;
    border: 2px solid #5c7aa6;
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
    color: white;
    margin-bottom: 20px;
}
h2, h3, h4 { margin-bottom: 15px; }
label { display: block; margin-top: 15px; font-weight: bold; }
input { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: none; }
button {
    padding: 6px 12px;
    border-radius: 20px;
    border: none;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    background: #1db954;
    color: white;
}
button:hover { background: #169944; }
.message { margin-top: 15px; text-align: center; font-weight: bold; }
.error { color: #ff5c5c; }
.success { color: #4dff88; }
.leitung-btn { margin-top: 5px; }
.dropdown-header {
    cursor: pointer;
    font-weight: bold;
}
.dropdown-content {
    display: none;
    margin-top: 10px;
}
hr {
    border-color: #5c7aa6;
}
</style>
</head>
<body>

<div class="container">
<h2>Leitung - Urlaube verwalten</h2>

<h3>Offene Urlaube</h3>
<div id="urlaubListLeitung"></div>

<h3>Genehmigte Urlaube</h3>
<div id="genehmigteUrlaube"></div>

<h3>Abgelehnte Urlaube</h3>
<div id="abgelehnteUrlaube"></div>

</div>

<script>

const BACKEND_URL = "https://urlaubsportal-backend-production.up.railway.app";
let urlaube = [];

function formatDateDE(dateStr){
    const d = new Date(dateStr);
    return d.toLocaleDateString("de-DE");
}

async function ladeUrlaube(){
    const res = await fetch(`${BACKEND_URL}/data`);
    const data = await res.json();
    urlaube = data.urlaube;
    renderLeitung();
}

async function genehmigen(name,start,end){
    await fetch(`${BACKEND_URL}/genehmigen`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,start,end})
    });
    ladeUrlaube();
}

async function ablehnen(name,start,end){
    await fetch(`${BACKEND_URL}/ablehnen`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,start,end})
    });
    ladeUrlaube();
}

async function loeschen(name,start,end){
    await fetch(`${BACKEND_URL}/loeschen`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,start,end})
    });
    ladeUrlaube();
}

function renderLeitung(){

    const offeneDiv=document.getElementById("urlaubListLeitung");
    const genehmigtDiv=document.getElementById("genehmigteUrlaube");
    const abgelehntDiv=document.getElementById("abgelehnteUrlaube");

    offeneDiv.innerHTML="";
    genehmigtDiv.innerHTML="";
    abgelehntDiv.innerHTML="";

    const offene=urlaube.filter(u=>u.status==="eingereicht");
    const genehmigte=urlaube.filter(u=>u.status==="genehmigt");
    const abgelehnte=urlaube.filter(u=>u.status==="abgelehnt");

    // OFFENE
    if(offene.length===0){
        offeneDiv.innerHTML="<p>Keine offenen Urlaube.</p>";
    }

    offene.forEach(u=>{
        const div=document.createElement("div");
        div.style.border="1px solid #5c7aa6";
        div.style.padding="10px";
        div.style.margin="8px 0";

        div.innerHTML=`
            <strong>${u.name}</strong> (${u.dienstnummer})<br>
            ${formatDateDE(u.start)} - ${formatDateDE(u.end)}<br>
            <strong>Grund:</strong> ${u.grund}
            <div style="display:flex; gap:10px; margin-top:8px;">
                <button onclick="genehmigen('${u.name}','${u.start}','${u.end}')">âœ” Genehmigen</button>
                <button onclick="ablehnen('${u.name}','${u.start}','${u.end}')">âœ– Ablehnen</button>
            </div>
        `;
        offeneDiv.appendChild(div);
    });

    renderGrouped(genehmigte, genehmigtDiv);
    renderGrouped(abgelehnte, abgelehntDiv);
}

function renderGrouped(list, container){

    if(list.length===0){
        container.innerHTML="<p>Keine EintrÃ¤ge vorhanden.</p>";
        return;
    }

    const grouped={};
    list.forEach(u=>{
        if(!grouped[u.name]) grouped[u.name]=[];
        grouped[u.name].push(u);
    });

    for(const name in grouped){

        const wrapper=document.createElement("div");
        wrapper.style.border="1px solid #5c7aa6";
        wrapper.style.padding="10px";
        wrapper.style.margin="8px 0";

        const header=document.createElement("div");
        header.className="dropdown-header";
        header.innerHTML=`â–¼ ${name} (${grouped[name][0].dienstnummer})`;

        const content=document.createElement("div");
        content.className="dropdown-content";

        grouped[name].forEach(u=>{
            const entry=document.createElement("div");
            entry.innerHTML=`
                ${formatDateDE(u.start)} - ${formatDateDE(u.end)}<br>
                <strong>Grund:</strong> ${u.grund}<br>
                <button onclick="loeschen('${u.name}','${u.start}','${u.end}')">ðŸ—‘ LÃ¶schen</button>
                <hr>
            `;
            content.appendChild(entry);
        });

        header.onclick=()=>{
            content.style.display = content.style.display==="block" ? "none" : "block";
        };

        wrapper.appendChild(header);
        wrapper.appendChild(content);
        container.appendChild(wrapper);
    }
}

ladeUrlaube();

</script>
</body>
</html>
